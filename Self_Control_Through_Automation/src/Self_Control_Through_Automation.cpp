/* 
 * Project Self_Control_Through_Automation
 * Author: Benjamin Brown
 * Date: 06282025
 * For comprehensive documentation and examples, please visit:
 * https://docs.particle.io/firmware/best-practices/firmware-template/
 */


#include "Particle.h"
#include "IoTTimer.h"
#include "wemo.h"
#include "Button.h"
#include "IoTClassroom_CNM.h"
#include "Adafruit_GFX.h"
#include "Adafruit_SSD1306.h"

SYSTEM_MODE(SEMI_AUTOMATIC);

//Bit_Maps

#define Y5QKLUG_BMPWIDTH  72
#define Y5QKLUG_BMPHEIGHT 64

const unsigned char bitmap_y5qklug[] PROGMEM = {
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0xFF,0xF8,0x00,0x00,0x00,
  0x00,0x00,0x00,0x03,0xFF,0xFF,0x00,0x00,0x00,
  0x00,0x00,0x00,0x0F,0x00,0x3F,0xC0,0x00,0x00,
  0x00,0x00,0x00,0x38,0x0C,0x3F,0xF0,0x03,0x90,
  0x00,0x00,0x00,0x71,0xFF,0xC3,0xF8,0x18,0x20,
  0x00,0x00,0x00,0xE6,0x07,0xC3,0xFE,0x20,0x10,
  0x00,0x00,0x00,0xFB,0xE8,0xA2,0xC0,0xA2,0x30,
  0x00,0x00,0x01,0x86,0x20,0x62,0x80,0x43,0xE0,
  0x00,0x03,0xA2,0x02,0x38,0x23,0x1C,0x20,0x00,
  0x03,0x9A,0x24,0x06,0x08,0x21,0x18,0x30,0x08,
  0x04,0x06,0x25,0x44,0x08,0x41,0x00,0x2F,0x88,
  0x08,0x02,0x08,0x44,0x14,0x50,0x07,0xE1,0x08,
  0x10,0xC2,0x18,0xC1,0x10,0x11,0x0E,0x30,0x10,
  0x10,0xB9,0x11,0x03,0x10,0x31,0x80,0x38,0x60,
  0x10,0x05,0x01,0x23,0x02,0x30,0xC0,0xF8,0x00,
  0x00,0x01,0x00,0x22,0x0E,0x00,0xFF,0xFC,0x00,
  0x08,0x01,0x00,0x22,0x82,0x0F,0x70,0xFC,0x00,
  0x03,0xE0,0x08,0x60,0x82,0xE0,0x70,0xFC,0x00,
  0x0F,0x90,0x8C,0x21,0x78,0x00,0x38,0xFE,0x00,
  0x08,0x70,0x8A,0x1E,0x00,0x00,0x38,0x7E,0x00,
  0x08,0x01,0x89,0x87,0xC0,0x00,0x38,0x7E,0x00,
  0x04,0x02,0x60,0x80,0x00,0x00,0x38,0x7E,0x00,
  0x01,0xF8,0x5A,0x00,0x00,0x00,0x1C,0x3F,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x1C,0x3F,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
};

#define UVOY98_BMPWIDTH  54 // m&m dispense face (green)
#define UVOY98_BMPHEIGHT  64
const unsigned char bitmap_uvoy98[] PROGMEM = {
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x30,0x18,0x00,0x00,0x00,
  0x00,0x00,0x78,0x1C,0x00,0x00,0x00,
  0x00,0x01,0xF8,0x1F,0x00,0x00,0x00,
  0x00,0x07,0xF8,0x3F,0xC0,0x00,0x00,
  0x00,0x1F,0xF0,0x1F,0xF0,0x00,0x00,
  0x00,0x7F,0xF0,0x1F,0xFC,0x00,0x00,
  0x00,0xFF,0xE0,0x0F,0xFE,0x00,0x00,
  0x00,0xFF,0x80,0x03,0xFF,0x00,0x00,
  0x01,0xFE,0x00,0x00,0xFF,0x00,0x00,
  0x01,0xF8,0x00,0x00,0x3F,0x00,0x00,
  0x03,0xE0,0x00,0x00,0x0F,0x80,0x00,
  0x03,0xC0,0x00,0x00,0x07,0x80,0x00,
  0x03,0x80,0x00,0x00,0x03,0x80,0x00,
  0x03,0x00,0x00,0x00,0x01,0x80,0x00,
  0x03,0x00,0x00,0x00,0x01,0x80,0x00,
  0x00,0x03,0x80,0x00,0x00,0x00,0x00,
  0x00,0x3F,0xF0,0x07,0xFC,0x00,0x00,
  0x00,0x70,0x38,0x0E,0x0F,0x00,0x00,
  0x00,0xC0,0x0C,0x18,0x03,0x80,0x00,
  0x01,0x80,0x06,0x30,0x00,0xC0,0x00,
  0x03,0x00,0x06,0x60,0x00,0x60,0x00,
  0x06,0x00,0x03,0x60,0x00,0x30,0x00,
  0x06,0x00,0x01,0xC0,0x00,0x30,0x00,
  0x0C,0x00,0x01,0xC0,0x00,0x18,0x00,
  0x0C,0x00,0x01,0xC0,0x00,0x18,0x00,
  0x18,0x01,0xFF,0xF0,0x00,0x08,0x00,
  0x1F,0xFF,0xFF,0xFF,0xFF,0xFC,0x00,
  0x7F,0x00,0x00,0x80,0x07,0xFF,0x00,
  0xC0,0x00,0x00,0x80,0x00,0x03,0x00,
  0xC0,0x00,0x01,0xC0,0x00,0x01,0x00,
  0xC3,0xFF,0xFF,0xFF,0xFF,0xC3,0x00,
  0x7F,0xEF,0xF1,0xC6,0xFF,0xFF,0x00,
  0x30,0xCF,0xF1,0xC6,0x7F,0x0C,0x00,
  0x10,0x4F,0xE1,0xC6,0x7F,0x04,0x00,
  0x18,0x6F,0xE3,0x66,0xFF,0x0C,0x00,
  0x18,0x7F,0xC2,0x63,0xFE,0x0C,0x00,
  0x08,0x3F,0x86,0x33,0xFC,0x08,0x00,
  0x0C,0x0E,0x0C,0x30,0xF0,0x18,0x00,
  0x04,0x00,0x1C,0x18,0x00,0x30,0x00,
  0x06,0x00,0x38,0x0C,0x00,0x30,0x00,
  0x03,0x80,0x60,0x07,0x00,0xE0,0x00,
  0x01,0xE3,0xC0,0x03,0xC3,0x80,0x00,
  0x00,0x7F,0x00,0x00,0xFF,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x60,
  0x00,0x00,0x00,0x00,0x00,0x00,0x7C,
  0x00,0x00,0x00,0x00,0x00,0x00,0x38,
  0x00,0x00,0x00,0x00,0x00,0x00,0x30,
  0x00,0x00,0x00,0x00,0x00,0x00,0x30,
  0x00,0x00,0x00,0x00,0x00,0x00,0x60,
  0x00,0x00,0x00,0x00,0x00,0x00,0x60,
  0x00,0x00,0x00,0x00,0x00,0x00,0xC0,
  0x10,0x00,0x00,0x00,0x00,0x03,0x80,
  0x1C,0x00,0x00,0x00,0x07,0xFF,0x00,
  0x0E,0x00,0x00,0x03,0xFF,0xE0,0x00,
  0x03,0xE0,0x01,0xFF,0xC0,0x00,0x00,
  0x00,0xFF,0xFF,0xE0,0x00,0x00,0x00,
  0x00,0x07,0xF0,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x7F,0x00,0x00,
  0x00,0x00,0x00,0x0F,0xFF,0x80,0x00,
  0x00,0x00,0x7F,0xFE,0x00,0x00,0x00,
  0x00,0x00,0x7F,0xC0,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00
};

#define KC4GMK_BMPWIDTH  128 // Sus face (Yellow)
#define KC4GMK_BMPHEIGHT 64
const unsigned char bitmap_kc4gmk[] PROGMEM = {
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x18,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x0F,0xE0,0x00,0x00,0x07,0xFF,0xC0,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x7F,0xFC,0x00,0x00,0x3F,0xFF,0xF0,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0xFF,0xFF,0xF8,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x01,0xFF,0xFF,0x80,0x03,0xFF,0xFF,0xFC,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x03,0xFF,0xFF,0xC0,0x07,0xFF,0xFF,0xFE,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x07,0xFF,0xFF,0xF0,0x0F,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x0F,0xFF,0xFF,0xF0,0x0F,0xFF,0xFF,0xFF,0x80,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x1F,0xFF,0xFF,0xF8,0x1F,0xFF,0xFF,0xFF,0x80,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x3F,0xFF,0xFF,0xF8,0x1F,0xFF,0xFF,0xFF,0xC0,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x3F,0xFF,0xFF,0xFC,0x1F,0xFF,0xFF,0xFF,0xC0,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x7F,0xFF,0xFF,0xFC,0x1F,0xFF,0x81,0xFF,0xC0,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x7F,0xC0,0x07,0xFC,0x1F,0xF0,0x00,0x1F,0xC0,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x7E,0x00,0x00,0xFC,0x0F,0x80,0x00,0x07,0xE0,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0xF8,0x00,0x00,0x38,0x00,0x00,0x00,0x01,0xE0,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0xE0,0x00,0x70,0x00,0x00,0x03,0x00,0x00,0xE0,0x00,0x00,0x00,
  0x00,0x00,0x00,0x01,0xC0,0x02,0x02,0x00,0x00,0x20,0x30,0x00,0x60,0x00,0x00,0x00,
  0x00,0x00,0x00,0x01,0x80,0x08,0x00,0x80,0x00,0x00,0x08,0x00,0x20,0x00,0x00,0x00,
  0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x40,0x00,0x00,0x02,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x40,0x00,0x20,0x00,0x00,0x01,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x80,0x00,0x00,0x02,0x00,0x00,0x80,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x10,0x00,0x00,0x00,0x40,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x04,0x00,0x00,0x20,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x02,0x00,0x00,0x08,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x08,0x00,0x00,0x10,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0x08,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x07,0x80,0x08,0x78,0x00,0x08,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x08,0x00,0xC0,0xF8,0x0F,0x80,0x80,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x08,0x0C,0x19,0x80,0x08,0xCC,0x18,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x61,0xC1,0xC0,0x08,0xC0,0xE1,0x04,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x13,0x0F,0xC1,0xC0,0x00,0xC0,0xFC,0x24,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x18,0x7F,0xC1,0xC4,0x01,0xC1,0xFF,0x84,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x12,0x7F,0xE3,0xC4,0x01,0xE1,0xFF,0x20,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x18,0x7F,0xF7,0xC4,0x01,0xF3,0xFF,0x0C,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x08,0x3F,0xFF,0xC0,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x08,0x3F,0xFF,0xC0,0x08,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x3F,0xFF,0x80,0x08,0xFF,0xFE,0x08,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x1F,0xFF,0x80,0x00,0x7F,0xFE,0x08,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x04,0x1F,0xFF,0x08,0x00,0x7F,0xFC,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x04,0x0F,0xFF,0x00,0x04,0x3F,0xFC,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x07,0xFE,0x10,0x00,0x1F,0xF8,0x10,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x02,0x03,0xF8,0x00,0x02,0x0F,0xE0,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x01,0x00,0x00,0x20,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x40,0x01,0x00,0x00,0x40,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x80,0x00,0x00,0x00,0x80,0x00,0x80,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x40,0x00,0x00,0x00,0x40,0x01,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x02,0x00,0x00,0x20,0x02,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x0C,0x08,0x00,0x00,0x08,0x08,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0xC0,0x00,0x00,0x00,0xC0,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
};

#define BP2YZJ_BMPWIDTH  128 // dead eyes (red)
#define BP2YZJ_BMPHEIGHT 64  
const unsigned char bitmap_bp2yzj[] PROGMEM = {
  0x00,0x03,0xFC,0x00,0x03,0x00,0x00,0x00,0x00,0x04,0xC0,0x00,0x00,0xFF,0xC0,0x00,
  0x00,0x07,0xFC,0x00,0x02,0x00,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0xFF,0xE0,0x00,
  0x00,0x07,0xF8,0x00,0x00,0x00,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0x7F,0xE0,0x00,
  0x00,0x0F,0xF0,0x00,0x00,0x00,0x00,0x00,0x0B,0xE4,0x00,0x00,0x00,0x3F,0xF8,0x00,
  0x00,0x0F,0xF0,0x00,0x00,0x00,0x00,0x00,0x0F,0xE4,0x00,0x07,0x00,0x3F,0xF8,0x00,
  0x00,0x1F,0xE0,0x1F,0x80,0x00,0x00,0x00,0x0F,0xF4,0x00,0x1F,0x00,0x1F,0xF0,0x00,
  0x00,0x1F,0xC0,0x3F,0xC0,0x00,0x1C,0x00,0x0F,0xFC,0x00,0x3E,0x00,0x1F,0xF8,0x00,
  0x00,0x3F,0xC0,0x3F,0xE0,0x00,0x3C,0x00,0x0F,0xFC,0x00,0xFE,0x00,0x0F,0xFC,0x00,
  0x00,0x3F,0x80,0x3F,0xF0,0x00,0xFC,0x00,0x0F,0xFF,0x03,0xF8,0x00,0x07,0xFC,0x00,
  0x00,0x7F,0x80,0x3F,0xF8,0x03,0xF8,0x00,0x0F,0xFF,0x8F,0xF0,0x00,0x87,0xFC,0x00,
  0x00,0x7F,0x00,0x3F,0xFC,0x0F,0xE0,0x00,0x07,0xFF,0xFF,0xE0,0x00,0x07,0xFE,0x00,
  0x04,0xFF,0x00,0x1F,0xFE,0x3F,0xC0,0x00,0x07,0xFF,0xFF,0xC0,0x01,0x03,0xFE,0x00,
  0x00,0xFE,0x00,0x1F,0xFF,0xFF,0x80,0x00,0x05,0xFF,0xFF,0x80,0x01,0x83,0xFE,0x00,
  0x01,0xFE,0x00,0x0F,0xFF,0xFF,0x00,0x00,0x04,0x7F,0xFF,0x00,0x10,0x03,0xFF,0x00,
  0x03,0xFC,0x00,0x0B,0xFF,0xFF,0x00,0x00,0x00,0x3F,0xFE,0x00,0x00,0x03,0xFF,0x00,
  0x03,0xFC,0x00,0x01,0xFF,0xFC,0x00,0x00,0x00,0x1F,0xFE,0x00,0x00,0x01,0xFF,0x00,
  0x07,0xFC,0x00,0x00,0xFF,0xFC,0x00,0x00,0x00,0x0F,0xFF,0x00,0x00,0x03,0xFF,0x80,
  0x07,0xF8,0x00,0x00,0x3F,0xFC,0x00,0x00,0x00,0x1F,0xFF,0xC0,0x01,0x01,0xFF,0x80,
  0x0F,0xF8,0x00,0x00,0x3F,0xFE,0x00,0x00,0x00,0x1F,0xFF,0xE0,0x00,0x01,0xFF,0x88,
  0x0F,0xF8,0x00,0x00,0x3F,0xFF,0x00,0x00,0x00,0x3F,0xFF,0xF0,0x00,0x00,0xFF,0x80,
  0x0F,0xF0,0x00,0x00,0x7F,0xFF,0x80,0x00,0x00,0x7F,0xBF,0xF8,0x00,0x00,0xFF,0x80,
  0x0F,0xF8,0x01,0x00,0xFF,0xFF,0xC0,0x00,0x00,0xFF,0x1F,0xFC,0x00,0x00,0xFF,0xE0,
  0x0F,0xF0,0x01,0x01,0xFE,0xFF,0xE0,0x00,0x01,0xFF,0x07,0xFE,0x00,0x00,0x7F,0xE0,
  0x0F,0xF0,0x01,0x03,0xFE,0x3F,0xF8,0x00,0x01,0xFE,0x03,0xFF,0x80,0x00,0x7F,0xF0,
  0x1F,0xF0,0x01,0x07,0xFC,0x1F,0xFC,0x00,0x03,0xFC,0x01,0xFF,0x80,0x00,0x7F,0xF8,
  0x1F,0xF0,0x01,0x07,0xF8,0x0F,0xFE,0x00,0x07,0xF8,0x00,0xFF,0xC0,0x00,0x7F,0xF8,
  0x1F,0xE0,0x01,0x0F,0xF0,0x07,0xFF,0x00,0x07,0xF8,0x00,0x3F,0xC0,0x00,0x7F,0xF8,
  0x1F,0xE0,0x01,0x0F,0xF0,0x01,0xFF,0x00,0x07,0xF0,0x00,0x1F,0xC0,0x00,0x7F,0xFC,
  0x1F,0xE0,0x01,0x1F,0xF0,0x00,0xFF,0x80,0x03,0xF0,0x00,0x0F,0x80,0x00,0x3F,0xFC,
  0x1F,0xE0,0x01,0x0F,0xE0,0x00,0x7F,0x00,0x03,0xE0,0x00,0x00,0x00,0x00,0x3F,0xF8,
  0x9F,0xE0,0x00,0x0F,0xC0,0x00,0x1E,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x3F,0xF0,
  0x1F,0xE0,0x00,0x0F,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x3F,0xC0,
  0x1F,0xE0,0x00,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x3F,0xC0,
  0x1F,0xE0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x3F,0xC0,
  0x1F,0xE0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0x80,0x00,0x3F,0xE0,
  0x0F,0xE0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x07,0xC0,0x00,0x3F,0xC0,
  0x07,0xE0,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0F,0xE0,0x00,0x3F,0xE0,
  0x07,0xF0,0x01,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0F,0xF0,0x00,0x7F,0xC0,
  0x07,0xF0,0x01,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x1F,0xF0,0x00,0x7F,0xC0,
  0x03,0xF8,0x01,0xC0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x1F,0xF0,0x00,0x7F,0xC0,
  0x03,0xFC,0x01,0xC0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x3F,0xF0,0x00,0x7F,0x80,
  0x03,0xFC,0x01,0xC0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x3F,0xF0,0x00,0x7F,0x80,
  0x03,0xFE,0x01,0x40,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x7F,0xE0,0x00,0x7F,0x00,
  0x01,0xFE,0x01,0x60,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x7F,0xE0,0x00,0xFF,0x00,
  0x01,0xFE,0x01,0x60,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xC0,0x00,0xFE,0x00,
  0x01,0xFF,0x01,0xF0,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0xFF,0xC0,0x00,0xFE,0x00,
  0x01,0xFF,0x03,0xF0,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0xFF,0xC0,0x01,0xFC,0x00,
  0x01,0xFF,0x83,0xF8,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0xFF,0x80,0x01,0xFC,0x00,
  0x00,0xFF,0x82,0xF8,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0xFF,0x80,0x01,0xF8,0x00,
  0x00,0xFF,0x86,0x7C,0x00,0x00,0x00,0x00,0x00,0x00,0x07,0xFF,0x80,0x03,0xF8,0x00,
  0x00,0xFF,0x86,0x7C,0x00,0x00,0x00,0x00,0x00,0x00,0x0F,0xFF,0x80,0x03,0xF8,0x00,
  0x00,0x7F,0x86,0x7E,0x00,0x00,0x00,0x00,0x00,0x00,0x0F,0xFD,0x80,0x23,0xF8,0x00,
  0x00,0x7F,0xC0,0x3E,0x00,0x00,0x00,0x00,0x00,0x00,0x1F,0xFD,0x80,0x07,0xF0,0x00,
  0x00,0xFF,0x80,0x3F,0x00,0x00,0x00,0x00,0x00,0x00,0x3F,0xFD,0x80,0x0F,0xF0,0x00,
  0x00,0x3F,0xC0,0x3F,0x00,0x00,0x00,0x00,0x00,0x00,0x7F,0xF9,0x80,0x0F,0xE0,0x00,
  0x00,0x3F,0xC0,0x1F,0x80,0x00,0x00,0x00,0x00,0x00,0xFF,0xE9,0x80,0x1F,0xE0,0x00,
  0x00,0x3F,0xC0,0x1F,0xC0,0x00,0x00,0x00,0x00,0x01,0xFF,0xC9,0x80,0x1F,0xC0,0x00,
  0x00,0x3F,0xE0,0x0F,0xE0,0x00,0x00,0x00,0x00,0x03,0xFF,0xC1,0x80,0x3F,0x80,0x00,
  0x00,0x2F,0xF0,0x0F,0xE0,0x00,0x00,0x00,0x00,0x07,0xFF,0x81,0x00,0x7F,0x80,0x00,
  0x00,0x2F,0xF0,0x07,0xF0,0x00,0x00,0x00,0x00,0x1F,0xFF,0x01,0x00,0x7F,0x80,0x00,
  0x00,0x27,0xF8,0x03,0xF8,0x00,0x00,0x00,0x00,0x1F,0xFE,0x01,0x00,0xFF,0x00,0x00,
  0x00,0x27,0xF8,0x03,0xFE,0x00,0x00,0x00,0x00,0x3F,0xFC,0x01,0x00,0xFE,0x00,0x00,
  0x00,0x23,0xFC,0x01,0xFE,0x00,0x00,0x00,0x00,0xFF,0xF8,0x00,0x01,0xFE,0x00,0x00,
  0x00,0x23,0xFC,0x00,0xFF,0x00,0x00,0x00,0x01,0xFF,0xE0,0x00,0x01,0xFC,0x00,0x00
};


const int THERM_PIN = D5;
const int POT_PIN = A5;
const int TONE_PIN = A2;
int potPos;
int dispenseTime = 1200;
static unsigned int disableTimerStart = 0;
int waitTime = 1000*60;
int goodboytime = (1000*60);//*12;
int longTime = (1000*60);//10;//*10)*6)*6 = (6hrs)
bool detected;
bool dispense_Flag = FALSE;
static bool lockOut_Flag = FALSE;
int scrnShift_32 = 36;
const int ORIGIN = 0;
unsigned int displaySec;
unsigned int displayMom = 4000;

int newState;
int oldState;

int m;
int wemo_AC=0;
int wemo_TV=2;
int BULB;
bool comfort = FALSE;

unsigned int msec;
static unsigned int startTime=0;

static bool unscrew_Flag = FALSE;
int unscrew = 255;
int slow_Rotate = 165;
int fast_rotate = 45;
int stop = 191;
int zero = 0;

//myObjects
IoTTimer goodBoyTimer,displayTimer, longCountTimer;
Servo myServo;
const int OLED_RESET =-1;
Adafruit_SSD1306 display(OLED_RESET);
Button button(D3);

//Functons
bool detectionCheck();


void setup() {
  //Start Serial
  Serial.begin(9600);
  waitFor(Serial.isConnected,10000);
  //Start OLED
  display.begin(SSD1306_SWITCHCAPVCC, 0x3C);
  display.clearDisplay();
  display.display();
  //Title Screen
  displaySec=millis(); 
  while (millis()-displaySec<displayMom){
  display.setTextSize(2);  // Power on screen
  display.setTextColor(WHITE);
  display.setCursor(24,0);
  display.printf("S-C-T-A\n");
  display.setCursor(54,16);
  display.printf("by\n");
  display.setCursor(8,32);
  display.printf("Ben_Brown\n");
  display.display();
  }
  //delay(2000);
  
  //Welcome Screen
  displaySec=millis(); 
  while (millis()-displaySec<displayMom){
  display.clearDisplay();  // Splash_Welcome_Screen
  display.drawBitmap(32, ORIGIN, bitmap_y5qklug,Y5QKLUG_BMPWIDTH,Y5QKLUG_BMPHEIGHT,WHITE);
  display.display();
  }
  //delay(2000);
  display.clearDisplay();
  display.display();

  pinMode(THERM_PIN,INPUT);
  pinMode(POT_PIN,OUTPUT);
  disableTimerStart = millis();
  oldState=digitalRead(THERM_PIN);

  //Start Wifi
  WiFi.on();
  WiFi.clearCredentials();
  WiFi.setCredentials("IoTNetwork");
  WiFi.connect();
  while(WiFi.connecting()){
    Serial.printf("^-.-^\n");
  }
  Serial.printf("Connected!!\n \n \n");

  //Set Initial room conditions
  switchON(wemo_AC);
  delay(50);
  Serial.printf("wemo AC on\n");
  switchON(wemo_TV);
  delay(50);
  Serial.printf("wemo TV on\n");
  for (BULB=0;BULB<7;BULB++){
  setHue(BULB,TRUE,HueGreen,255,255);
  Serial.printf(" Hue on %i\n",BULB);
  delay(50);
  }
}
void loop() {
  //Override Button Logic
  if (button.isPressed()){
    m=0;
    analogWrite(POT_PIN,fast_rotate);
    Serial.printf("Candy for the Fatty!\n");
    while(button.isPressed());
    analogWrite(POT_PIN,stop);
    delay(2);
    analogWrite(POT_PIN,zero);
  }else{

  //display pleased face
  if (m<=4){
  display.clearDisplay();  // Dispence face
  display.drawBitmap(scrnShift_32,ORIGIN, bitmap_uvoy98,UVOY98_BMPWIDTH,UVOY98_BMPHEIGHT,WHITE);
  display.display();
  }
  //Room control _ Dispense logic
  detected=detectionCheck(); // check sensor for signal
  if ((millis() - disableTimerStart > waitTime)&&(lockOut_Flag==FALSE)){ // disable sensor, timing
    if (detected){
      startTime=millis(); //set time condition for future stop
      analogWrite(POT_PIN,fast_rotate); //dispense until stopped
      dispense_Flag=TRUE;
      Serial.printf("Dispensing%i\n",dispenseTime);
      disableTimerStart=millis(); // reset disable timer
      m++; // increment m + 1
      displaySec=millis(); 
        if (millis()-displaySec<displayMom){
        display.clearDisplay();
        display.setTextSize(2);
        display.setTextColor(BLACK,WHITE);
        display.setCursor(28,8);
        display.printf(" Taste\n");
        display.setCursor(28,24);
        display.printf(" the \n");
        display.setCursor(14,40);
        display.printf(" rainbow!\n");
        display.display();
        }
      //Green Condition
      if (m==1){
        goodBoyTimer.startTimer(goodboytime);
        if(!comfort){
        switchON(wemo_AC);
        switchON(wemo_TV);
        comfort=TRUE;
        }
        for (BULB=0;BULB<7;BULB++){
        setHue(BULB,TRUE,HueBlue,255,255);
        Serial.printf(" Hue on %i\n",BULB);
        delay(50);
        setHue(BULB,TRUE,HueViolet,255,255);
        Serial.printf(" Hue on %i\n",BULB);
        delay(50);
        setHue(BULB,TRUE,HueGreen,255,255);
        delay(50);
        Serial.printf(" Hue on %i\n",BULB);
        }
        Serial.printf("m=%i\n",m);
      }
      if((m>=2) && (m<=4)){
        for (BULB=0;BULB<7;BULB++){
        setHue(BULB,TRUE,HueBlue,255,255);
        Serial.printf(" Hue on %i\n",BULB);
        delay(50);
        setHue(BULB,TRUE,HueViolet,255,255);
        Serial.printf(" Hue on %i\n",BULB);
        delay(50);
        setHue(BULB,TRUE,HueGreen,255,255);     
        Serial.printf(" Hue on %i\n",BULB);
        delay(50);
        }
        Serial.printf("m=%i\n",m);
      }
      //Yellow condition
      if((5<=m) && (m<8)){
        for (BULB=0;BULB<7;BULB++){
        setHue(BULB,TRUE,HueOrange,255,255);
        delay(50);
        Serial.printf(" Hue on %i\n",BULB);
        setHue(BULB,TRUE,HueYellow,255,255);
        delay(50);
        Serial.printf(" Hue on %i\n",BULB);
        delay(50);
        }
        display.clearDisplay();  // Sus Face
        display.drawBitmap(ORIGIN, ORIGIN, bitmap_kc4gmk,KC4GMK_BMPWIDTH,KC4GMK_BMPHEIGHT,WHITE);
        //displayTimer.startTimer(FACE_TIME);
        display.display();
        Serial.printf("m=%i\n",m);
      }
        //Red condition with disabling logic
        if(m==8){
        longCountTimer.startTimer(longTime); //(60000*10)*6)*6 = (6hrs)
        switchOFF(wemo_AC);
        switchOFF(wemo_TV);
        comfort=FALSE;
        for (BULB=0;BULB<7;BULB++){
        setHue(BULB,TRUE,HueRed,255,255);
        delay(50);
        }    
        display.clearDisplay();  // Dead Eyes
        display.drawBitmap(ORIGIN, ORIGIN, bitmap_bp2yzj,BP2YZJ_BMPWIDTH,BP2YZJ_BMPHEIGHT,WHITE);
        display.display();
        tone(TONE_PIN,800,2000);
        delay(50);
          tone(TONE_PIN,1200,2000);
          delay(50);
            tone(TONE_PIN,1600,2000);
            delay(50);
              tone(TONE_PIN,2000,2000);
              delay(50);
                tone(TONE_PIN,2400,2000);
                delay(50);
                  tone(TONE_PIN,2800,2000);
                  delay(50);
                    tone(TONE_PIN,3200,2000);
                    delay(50);
                      tone(TONE_PIN,3600,2000);
                      delay(50);
                        tone(TONE_PIN,4000,2000);
                        delay(50);
                          tone(TONE_PIN,4400,2000);
                          delay(50);
                            tone(TONE_PIN,4800,2000);
                            delay(500);

        Serial.printf("m=%i\n",m);

        analogWrite(POT_PIN,stop);
        delay(2);
        analogWrite(POT_PIN,zero);
        Serial.printf("NO MORE m&m's fatso!\n      GO OUTSIDE!\n");

        lockOut_Flag=TRUE;    
      }
  }   
    // Stop dispense logic
    if ((millis()-startTime>dispenseTime&&dispense_Flag==TRUE)){ // stop dispense
    analogWrite(POT_PIN,stop);
    delay(50);
    analogWrite(POT_PIN,zero);
    Serial.printf("STOP_STOP_STOP_Dispensing\n \n \n Stopped\n");
    dispense_Flag=FALSE;
    unscrew_Flag=FALSE;
  }   
}
}
  //Reset logic
  if((m==8)&&(longCountTimer.isTimerReady())){
    m=0;
    Serial.printf("m=%i\n",m); 
    for (BULB=0;BULB<7;BULB++){
    setHue(BULB,TRUE,HueBlue,255,255);
    delay(50);
    }
    lockOut_Flag=FALSE;
  }
}
//MY FUNCTIONS

// void dispense(unsigned int msec){
//   static bool started = FALSE;
//   static unsigned int startTime=0;

//   int rotate = 60;
//   int stop = 192;
//   if (!started){
//     startTime=millis();
//     analogWrite(potPin,rotate);
//     started = TRUE;
//   }
//   if (millis()-startTime>msec){
//      analogWrite(potPin,stop);
//      started = FALSE;
//   }
//}
  
bool detectionCheck(){
 newState=digitalRead(THERM_PIN);
    if(oldState!=newState){
      if(newState==TRUE){
    Serial.printf("DETECTED\n",newState);
    }else{
      Serial.printf("COLD\n",newState);
    }
    oldState=newState;
  } 
  return newState;
}



